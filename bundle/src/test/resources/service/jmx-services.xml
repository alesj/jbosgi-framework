<deployment xmlns="urn:jboss:bean-deployer:2.0">

  <!-- JMX Deployment -->

  <bean name="JMXKernel" class="org.jboss.test.osgi.service.support.JBossJMXKernel" />

  <bean name="ServiceMetaDataICF" class="org.jboss.system.deployers.managed.ServiceMetaDataICF">
    <property name="mbeanServer">
      <inject bean="JMXKernel" property="mbeanServer" />
    </property>
  </bean>
  <bean name="SARDeployer" class="org.jboss.system.deployers.SARDeployer" />
  <bean name="ServiceClassLoaderDeployer" class="org.jboss.system.deployers.ServiceClassLoaderDeployer" />
  <bean name="ServiceDeploymentDeployer" class="org.jboss.system.deployers.ServiceDeploymentDeployer" />
  <bean name="ServiceDeployer" class="org.jboss.system.deployers.ServiceDeployer">
    <constructor>
      <parameter>
        <inject bean="JMXKernel" property="serviceController" />
      </parameter>
    </constructor>
  </bean>

  <!-- Intercept all annotation plugings -->

  <bean name="BeanAnnotationAdapterFactory" class="org.jboss.kernel.plugins.annotations.BeanAnnotationAdapterFactory">
    <constructor factoryMethod="getInstance" />
  </bean>

  <bean name="BeanAnnotationAdapter">
    <constructor factoryMethod="getBeanAnnotationAdapter">
      <factory bean="BeanAnnotationAdapterFactory" />
    </constructor>
    <incallback method="addAnnotationPlugin" />
    <uncallback method="removeAnnotationPlugin" />
  </bean>

  <!-- Support for @JMX -->
  <lifecycle-configure xmlns="urn:jboss:aop-beans:1.0" name="JMXRegistrationAdvice" class="org.jboss.system.microcontainer.jmx.ServiceControllerRegistrationLifecycleCallback"
    classes="@org.jboss.aop.microcontainer.aspects.jmx.JMX">
    <property name="serviceController">
      <inject bean="JMXKernel" property="serviceController" />
    </property>
  </lifecycle-configure>
  <lifecycle-create xmlns="urn:jboss:aop-beans:1.0" name="JMXCreateDestroyAdvice" class="org.jboss.system.microcontainer.jmx.ServiceControllerCreateDestroyLifecycleCallback"
    classes="@org.jboss.aop.microcontainer.aspects.jmx.JMX">
    <property name="serviceController">
      <inject bean="JMXKernel" property="serviceController" />
    </property>
  </lifecycle-create>
  <lifecycle-install xmlns="urn:jboss:aop-beans:1.0" name="JMXStartStopAdvice" class="org.jboss.system.microcontainer.jmx.ServiceControllerStartStopLifecycleCallback"
    classes="@org.jboss.aop.microcontainer.aspects.jmx.JMX">
    <property name="serviceController">
      <inject bean="JMXKernel" property="serviceController" />
    </property>
  </lifecycle-install>

  <bean name="Invoker" class="org.jboss.test.osgi.service.support.MockInvoker">
    <annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss:service=invoker,type=unified",exposedInterface=org.jboss.test.osgi.service.support.MockInvokerMBean.class,registerDirectly=true)</annotation>
  </bean>

</deployment>